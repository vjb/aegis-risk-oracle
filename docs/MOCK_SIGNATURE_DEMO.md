# Aegis Risk Oracle - Verifiable AI Signature Demo

## The Triple Lock Standard

Aegis implements the **Triple Lock Standard** for all AI risk verdicts. This ensures that every signature is cryptographically bound to the specific context of the trade.

1.  **Identity Lock**: Bound to the user's wallet address.
2.  **Value Lock**: Bound to the token price at the time of analysis.
3.  **Time Lock**: Valid for a 5-minute window to prevent stale risk data.

## Signed Result Output

The `run-full-flow.ps1` script demonstrates the live generation and verification of these payloads:

```json
{
  "assessment": {
    "tokenAddress": "0x4200000000...0006",
    "chainId": "8453",
    "riskScore": 2,
    "decision": "EXECUTE",
    "timestamp": 1770481412
  },
  "signature": "0x544b9cb5b90b53453574...",
  "donPublicKey": "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266"
}
```

## Security Demonstrations

You can run the interactive security suite to see these locks in action:

```powershell
# Run the standalone signature verification demo
.\tests\test-crypto.ps1
```

### Scenarios Covered:
- ✅ **Valid Flow**: Successful verification of a fresh DON signature.
- ✅ **Replay Attack**: Blocked when trying to reuse a salt/hash.
- ✅ **Identity Hijack**: Blocked when a malicious user tries to use someone else's assessment.
- ✅ **Price Tamper**: Blocked when the asset price is modified after signing.
- ✅ **Spoof Attack**: Blocked when an attacker tries to sign with their own key.

## Production Architecture

In a production environment, this payload bridges the gap between AI intuition and on-chain security:

1.  **AI Analysis**: Chainlink CRE nodes analyze risk.
2.  **Consensus**: Multiple nodes reach consensus on the risk score and decision.
3.  **Threshold Signing**: The DON generates a single threshold signature.
4.  **On-Chain Verification**: `AegisVault.sol` verifies the signature and enforces the risk policy.

---

## Technical Proof (For Video)

> "Aegis doesn't just return data; it returns **signed proof**. By using the Triple Lock standard, we ensure that an AI's decision is securely bound to the user's identity and the current market value. As you can see in the demo, the Aegis smart contract automatically rejects any payload where the signature doesn't match the authorized DON or where an attacker attempts to replay an old approval."
## Production Flow (Explained for Hackathon Demo)

### 1. Agent Calls Oracle
```typescript
// ElizaOS or other AI agent
const response = await fetch(AEGIS_ORACLE_URL, {
  method: 'POST',
  body: JSON.stringify({
    tokenAddress: "0x833...",
    chainId: "8453",
    askingPrice: "2050.00"
  })
});

const { result, signature, donPublicKey } = await response.json();
```

### 2. DON Signs Result
In production, the CRE DON would:
- Run consensus across multiple nodes
- Aggregate results using BFT consensus
- **Sign the final result** with the DON's private key
- Return the signed payload

### 3. Agent Submits to Smart Contract
```solidity
// AegisVault.sol on Base
function executeWithOracle(
    address token,
    uint256 amount,
    bytes calldata signedResult
) external {
    // 1. Verify DON signature
    require(verifyDONSignature(signedResult), "Invalid signature");
    
    // 2. Decode risk assessment
    (uint8 riskScore, string memory decision) = decodeResult(signedResult);
    
    // 3. Enforce policy
    require(keccak256(bytes(decision)) == keccak256("EXECUTE"), "Rejected");
    require(riskScore < 7, "Risk too high");
    
    // 4. Execute trade
    _swap(token, amount);
}
```

## Key Points for Demo Video

1. **Security**: DON signature prevents tampering - agent can't fake a good risk score
2. **Decentralization**: Multiple nodes must agree on the risk assessment
3. **On-chain Verification**: Smart contract verifies the signature came from authorized DON
4. **Cross-chain**: Works for tokens on any EVM chain (Base, BSC, Ethereum, etc.)

## Mock vs Production

| Aspect | Mock (Demo) | Production |
|--------|-------------|-----------|
| **Signature** | Uses entropy as mock | Real ECDSA signature from DON |
| **Public Key** | Hardcoded demo address | Real DON public key |
| **Verification** | Not enforced | Smart contract verifies on-chain |
| **Consensus** | Single simulation | BFT across multiple nodes |

## For the Hackathon Video

**Point to this log output and say:**

> "Here you can see the signed result. In production, this signature would be generated by the Chainlink DON's private key after reaching consensus across multiple nodes. An AI agent would then submit this signed result to the Aegis smart contract on Base, which would verify the signature before allowing the trade to execute. This prevents agents from bypassing risk checks or executing scam trades."

This demonstrates you understand the full production architecture and the cryptographic hand-off between Chainlink CRE and on-chain logic. Even in simulation, Aegis generates a **verifiable-style payload** that bridges the gap between AI intuition and blockchain security.
